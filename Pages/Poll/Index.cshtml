@page "{id?}"
@model PollModel
@{
ViewData["Title"] = @Model.Poll.Title;
Layout = "_Layout";
}

<div class="tw:flex tw:justify-between tw:gap-10">
    <div class="tw:w-1/3">
        <img src="@Model.Poll.ImageUrl" alt="">
    </div>
    <form method="post" asp-ajax="true" asp-ajax-mode="replace" asp-ajax-update="this" class="tw:flex
        tw:flex-col tw:w-2/3">
        @Html.AntiForgeryToken()

        <h2 class="tw:font-semibold">@Model.Poll.Title</h2>
        <h3 class="tw:text-gray-400 tw:font-light">@Model.Poll.Description</h3>

        <div class="tw:flex tw:w-full tw:justify-between tw:mt-10">
            <div class="tw:flex tw:flex-col">
                @foreach (var option in Model.Poll.Options)
                {
                var index = Model.Poll.Options.IndexOf(option);
                <div class="tw:flex tw:items-center tw:gap-5">
                    <input type="radio" name="SelectedOption" value="@index" @(Model.VotedFor==index ? "checked" : "" )
                        id="option_@index" />
                    <label class="tw:pb-0.5" for="option_@index">@option</label> <!-- show the option text -->
                </div>
                }
            </div>

            <div class="tw:flex tw:flex-col tw:gap-5">
                <button asp-page-handler="Vote" class="btn btn-primary">Vote/Unvote</button>
                <button asp-page-handler="VoteAnonymous" class="btn btn-secondary">Vote anonymously</button>
            </div>
        </div>

        <div class="tw:w-60 tw:h-60">
            <canvas id="pie-chart"></canvas>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const labels = @Json.Serialize(Model.Poll.Options);
            const data = @Json.Serialize(Model.VoteCounts);

            new Chart(document.getElementById("pie-chart"), {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ["#FF5733", "#33FF57", "#3357FF", "#F1C40F", "#9B59B6"] // add more colors if needed
                    }]
                },
                options: {
                    responsive: false
                }
            });
        </script>
    </form>

</div>